(this["webpackJsonppdf-sign"]=this["webpackJsonppdf-sign"]||[]).push([[0],{118:function(e,t){},188:function(e,t,n){},189:function(e,t,n){},190:function(e,t,n){},216:function(e,t){},217:function(e,t){},218:function(e,t){},219:function(e,t){},220:function(e,t){},388:function(e,t,n){},390:function(e,t,n){"use strict";n.r(t);var a,i=n(1),r=n.n(i),c=n(39),s=n.n(c),o=(n(188),n(8)),d=(n(189),n(5)),u=(n(190),n(191),n(79));function l(e,t){switch(t.type){case a.Preview:return Object(d.a)(Object(d.a)({},e),{},{visibility:a.Preview});case a.SignPad:return Object(d.a)(Object(d.a)({},e),{},{visibility:a.SignPad})}}!function(e){e[e.Preview=0]="Preview",e[e.SignPad=1]="SignPad"}(a||(a={}));var f=n(75),h=n.n(f),p=n(110),g=n(174),j=n(393),b=n(392),v=n(76),m=n(173),O=n(6);u.c.GlobalWorkerOptions.workerSrc="https://chuntian.press/pdf_sign_react/pdf.worker.js";var w={cMapUrl:"cmaps/",cMapPacked:!0};function x(e){var t=e.dispatch,n=r.a.useState(null),c=Object(o.a)(n,2),s=c[0],l=c[1],f=r.a.useState(null),x=Object(o.a)(f,2),y=x[0],L=x[1],N=r.a.createRef(),R=r.a.createRef(),C=Object(i.useState)(1),k=Object(o.a)(C,2),P=k[0],U=k[1],S=r.a.useRef({height:0,width:0,top:0,left:0,scale:1,scaleWidth:0,scaleHeight:0}),_=r.a.useRef(Object(m.a)()),M=r.a.useRef(),E=r.a.useRef();r.a.useEffect((function(){var e=function(e){return e.preventDefault()};return document.addEventListener("gesturestart",e),document.addEventListener("gesturechange",e),function(){document.removeEventListener("gesturestart",e),document.removeEventListener("gesturechange",e)}}),[]);var H=Object(p.useSpring)((function(){return{x:0,y:0,scale:1}})),W=Object(o.a)(H,2),A=W[0],z=A.x,F=A.y,D=A.scale,B=W[1],T=Object(g.useDrag)((function(e){var t=e.active,n=Object(o.a)(e.movement,2),a=n[0],i=n[1],r=S.current,c=r.width,s=r.height,u=r.scaleHeight,l=r.scaleWidth,f=r.left,h=r.top,p=r.scale,g=f+a,j=h+i,b=Math.max(Math.min(g,window.innerWidth-(v.isBrowser?32:20)-c-l),(v.isBrowser?14:20)+l),m=Math.max(Math.min(j,window.innerHeight-40-s-u),0+u);if(!t){var O,w=null===(O=R.current)||void 0===O?void 0:O.scrollTop;if(w){for(var x=s*p,y=0,L=0;L<w+m-u;){L=L+_.current.get(y).viewHeight+8,y+=1}var N=L-8-m-w+u-x;if(N<0)return void(L-8-w+u>x?(S.current=Object(d.a)(Object(d.a)({},S.current),{},{top:m+N,left:b}),B.start({x:b,y:S.current.top})):(S.current=Object(d.a)(Object(d.a)({},S.current),{},{top:m+x+N+8,left:b}),B.start({x:b,y:S.current.top})))}}t||(S.current=Object(d.a)(Object(d.a)({},S.current),{},{top:m,left:b})),B.start({x:b,y:m})}));return Object(O.jsx)("div",{className:"root",children:Object(O.jsxs)("div",{className:"root",style:{height:"100%"},children:[Object(O.jsxs)("div",{className:"pdf",ref:R,children:[y&&Object(O.jsx)(p.animated.div,Object(d.a)(Object(d.a)({className:"card"},T()),{},{style:{x:z,y:F,scale:D},children:Object(O.jsx)("img",{src:y,ref:N,className:"image",draggable:!1,onLoad:function(){var e=N.current;e&&(S.current=Object(d.a)(Object(d.a)({},S.current),{},{height:e.offsetHeight,width:e.offsetWidth}))}})})),s&&Object(O.jsx)(u.a,{file:s,onLoadSuccess:function(e){U(e.numPages)},options:w,children:Array.from(new Array(P),(function(e,t){return Object(O.jsx)(u.b,{pageNumber:t+1,className:"pdf-page",onLoadSuccess:function(e){return function(e,t){var n=_.current,a={index:e,originalHeight:t.originalHeight,originalWidth:t.originalWidth,viewHeight:t.height,viewWidth:t.width,scale:t.originalHeight/t.height};_.current=n.set(e,a)}(t,e)},width:window.innerWidth-40},"page_".concat(t+1))}))})]}),Object(O.jsxs)("div",{className:"gride",children:[Object(O.jsx)("label",{htmlFor:"input_pdf",className:"rs-btn rs-btn-default input-label rs-btn-sm",children:"\u4e0a\u4f20pdf"}),Object(O.jsx)("input",{id:"input_pdf",type:"file",accept:".pdf",className:"hiden",onChange:function(e){var t=e.target.files;console.log(t),t&&t.length>0&&(console.log(URL.createObjectURL(t[0])),l(URL.createObjectURL(t[0])),M.current=t[0])}}),Object(O.jsx)("label",{htmlFor:"input_img",className:"rs-btn rs-btn-default input-label rs-btn-sm",children:"\u4e0a\u4f20\u7b7e\u540d"}),Object(O.jsx)("input",{id:"input_img",type:"file",accept:"image/jpeg",className:"hiden",onChange:function(e){var t=e.target.files;if(t&&t.length>0){var n=t[0];console.log(URL.createObjectURL(n)),L(URL.createObjectURL(n)),E.current=n}}}),Object(O.jsx)(j.a,{size:"sm",onClick:function(){t({type:a.SignPad})},children:"\u751f\u6210\u7b7e\u540d"}),Object(O.jsx)(j.a,{size:"sm",onClick:function(){for(var e,t=(null===(e=R.current)||void 0===e?void 0:e.scrollTop)||0,n=S.current,a=n.width,i=n.height,r=n.scale,c=n.top,s=n.left,o=n.scaleWidth,d=n.scaleHeight,u=i*r,l=0,f=0,p=1,g=t+c+u-d;f<g;){var j=_.current.get(l);f=f+j.viewHeight+8,l+=1,p=j.scale}var b=(f-8-g)*p,m=(s-o-(v.isBrowser?14:20))*p,O=new FormData;O.append("file",E.current),h.a.post("https://pdfsign.chuntian.press/savefile",O,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){var t=new FormData;return t.append("file",M.current),h.a.post("https://pdfsign.chuntian.press/savefile",t,{headers:{"Content-Type":"multipart/form-data"}})})).then((function(e){var t={pdf_name:M.current.name,img_name:E.current.name,pdf_page:l,img_width:a*r*p,img_height:u*p,position_x:m,position_y:b};return h.a.post("https://pdfsign.chuntian.press/mergeImage",t)})).then((function(e){return function(e,t){if(navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome"))window.open(e);else{var n=document.createElement("a");n.setAttribute("display","none"),n.href=e,n.download=t,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(e)}}("https://pdfsign.chuntian.press/publick/".concat(e.data),"merge_image.pdf")})).catch((function(e){return console.log(e)}))},className:"marginLeft4",children:"\u4fdd\u5b58"}),Object(O.jsx)("div",{className:"slider",children:Object(O.jsx)(b.a,{progress:!0,min:10,max:200,defaultValue:100,onChange:function(e){var t=e/100,n=S.current,a=n.width,i=n.height,r=n.left,c=n.top,s=n.scale,o=a*(t-1)/2,u=i*(t-1)/2,l=r;2*r+a*t<window.innerWidth?l+=a*(t-s)/2:l-=a*(t-s)/2;var f=c-i*(t-s)/2;S.current=Object(d.a)(Object(d.a)({},S.current),{},{scale:t,scaleWidth:o,scaleHeight:u,left:l,top:f}),B.start({scale:t,x:l,y:f})}})})]})]})})}n(388);var y=n(182);function L(e){var t=e.dispatch,n=r.a.createRef(),i=r.a.useRef();function c(){var e,t,a=n.current;if(null!==a){var r=Math.max(window.devicePixelRatio||1,1);a.width=a.offsetWidth*r,a.height=a.offsetHeight*r,null===(e=a.getContext("2d"))||void 0===e||e.scale(r,r),null===(t=i.current)||void 0===t||t.clear()}}function s(e,t){if(navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome"))window.open(e);else{var n=function(e){for(var t=e.split(";base64,"),n=t[0].split(":")[1],a=window.atob(t[1]),i=a.length,r=new Uint8Array(i),c=0;c<i;++c)r[c]=a.charCodeAt(c);return new Blob([r],{type:n})}(e),a=window.URL.createObjectURL(n),i=document.createElement("a");i.setAttribute("display","none"),i.href=a,i.download=t,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a)}}return r.a.useEffect((function(){i.current=new y.a(n.current,{backgroundColor:"rgb(255, 255, 255)",penColor:"rgb(0, 0, 0)"})}),[]),r.a.useLayoutEffect((function(){return window.addEventListener("resize",c),c(),function(){return window.removeEventListener("resize",c)}})),Object(O.jsx)("div",{className:"root",children:Object(O.jsx)("div",{className:"signature-pad-parent",children:Object(O.jsxs)("div",{id:"signature-pad",className:"signature-pad",children:[Object(O.jsx)("div",{className:"signature-pad--body",children:Object(O.jsx)("canvas",{ref:n})}),Object(O.jsxs)("div",{className:"signature-pad--footer",children:[Object(O.jsx)("div",{className:"description",children:"\u8bf7\u5728\u4e0a\u65b9\u7b7e\u540d"}),Object(O.jsxs)("div",{className:"signature-pad--actions",children:[Object(O.jsxs)("div",{children:[Object(O.jsx)(j.a,{size:"sm",className:"button clear","data-action":"clear",onClick:function(){var e;null===(e=i.current)||void 0===e||e.clear()},children:"\u6e05\u7a7a"}),Object(O.jsx)(j.a,{size:"sm","data-action":"change-color",onClick:function(){var e=i.current;if(e){var t="rgb("+Math.round(255*Math.random())+","+Math.round(255*Math.random())+","+Math.round(255*Math.random())+")";e.penColor=t}},children:"\u6539\u53d8\u989c\u8272"}),Object(O.jsx)(j.a,{size:"sm",className:"button","data-action":"undo",onClick:function(){var e=i.current;if(e){var t=e.toData();t&&(t.pop(),e.fromData(t))}},children:"\u56de\u9000"})]}),Object(O.jsxs)("div",{children:[Object(O.jsx)(j.a,{size:"sm",className:"button save","data-action":"save-png",onClick:function(){var e=i.current;e&&!e.isEmpty()&&s(e.toDataURL("image/jpeg"),"signature.jpg")},children:"\u4fdd\u5b58"}),Object(O.jsx)(j.a,{size:"sm",type:"button",className:"button save signature-pad-exit","data-action":"save-png",onClick:function(){t({type:a.Preview})},children:"\u9000\u51fa"})]})]})]})]})})})}n(389);var N=function(){var e=r.a.useReducer(l,{visibility:a.Preview}),t=Object(o.a)(e,2),n=t[0],i=t[1];return Object(O.jsx)(O.Fragment,{children:n.visibility===a.Preview?Object(O.jsx)(x,{dispatch:i}):Object(O.jsx)(L,{dispatch:i})})},R=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,394)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,r=t.getLCP,c=t.getTTFB;n(e),a(e),i(e),r(e),c(e)}))};s.a.render(Object(O.jsx)(r.a.StrictMode,{children:Object(O.jsx)(N,{})}),document.getElementById("root")),R()}},[[390,1,2]]]);
//# sourceMappingURL=main.94b8d37c.chunk.js.map